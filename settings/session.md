---
layout: default
title: セッションタイムアウト
---

シラサギのセッションタイムアウトには、ハードリミットとソフトリミットとが設定されています。
ハードリミットとは、データベースに設定された制限で、ソフトリミットとは、シラサギに設定された制限です。

## ソフトリミット

ソフトリミットの既定値は 30 分で、30 分間何も操作しなければ自動でログアウトします。
ここでは、設定方法を解説します。

### 変更方法

ソフトリミットは設定ファイル `sns.yml` に設定されています。
`sns.yml` を変更する前に次のコマンドでコピーしましょう。

~~~
$ cp -n config/defaults/sns.yml config/sns.yml
~~~

`sns.yml` に次のような設定があります。

~~~
production:
  session_lifetime: 1800
~~~

この設定は、セッションのタイムアウトを秒数で設定しています。
既定は 1800 秒 = 30 分となっています。

## ハードリミット

ハードリミットは、データベースに設定された制限で、既定値は 60 分です。
ソフトリミットの設定値にかかわらず、既定では最大 60 分間何も操作しなければ自動でログアウトします。

### 変更方法

`mongo` コマンドでデータベースにログインした後、
ハードリミットを 120 分に変更したい場合、次のコマンドを実行します。

~~~
use シラサギが利用しているデータベース;
// 認証が必要な場合、次のコマンドを実行
// db.auth("ユーザーID", "パスワード");
db.sessions.dropIndex("updated_at_1");
db.sessions.createIndex({ updated_at: 1 }, { expireAfterSeconds: 7200 });
~~~

最後の `db.sessions.createIndex({ updated_at: 1 }, { expireAfterSeconds: 7200 });` を実行せずにおくと、ハードリミットを削除することができます。

## 制限

ソフトリミットは、ハードリミットの範囲内で変更させることができます。
ハードリミットの既定値は 60 分ですので、既定ではソフトリミットは最大 3600 秒までの範囲で設定することが出来ます。
