---
layout: default
title: MongoDB8.0へのアップグレード
---

MongoDBの5.0系列以降ではAVXという拡張命令セットが有効になっている必要があります。<br>
参考: https://www.mongodb.com/docs/manual/administration/production-notes/#platform-support-notes

### 事前確認

アップグレード前に、現在のバージョンが 7.0 であること、および featureCompatibilityVersion が "7.0" に設定されていることを確認してください。

```
$ mongosh
> db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )
* 出力結果が下記のようになっていればOK
{ featureCompatibilityVersion: { version: '7.0' }, ok: 1 }
```

また、使用しているMongoDBドライバーが8.0に対応していることを確認してください。<br>
参考: https://www.mongodb.com/docs/drivers/

### v7.0 から v8.0 へのアップグレード

1. v8.0 のリポジトリ登録

   ```
   $ sudo vi /etc/yum.repos.d/mongodb-org-8.0.repo
   ```

   ```
   [mongodb-org-8.0]
   name=MongoDB Repository
   baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/8.0/x86_64/
   gpgcheck=1
   enabled=0
   gpgkey=https://www.mongodb.org/static/pgp/server-8.0.asc
   ```

2. v7.0 のアンインストール

   ```
   $ sudo systemctl disable mongod --now
   $ sudo dnf remove -y mongodb-org
   ```

3. v8.0 のインストール

   ```
   $ sudo dnf install -y --enablerepo=mongodb-org-8.0 mongodb-org
   $ sudo systemctl enable mongod --now
   $ mongosh
   > db.adminCommand( { setFeatureCompatibilityVersion: "8.0", confirm: true } )
   > db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )
   * 出力結果が下記のようになっていればOK
   { featureCompatibilityVersion: { version: '8.0' }, ok: 1 }
   ```
